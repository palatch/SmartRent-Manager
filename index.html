
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SmartRent Manager</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: sans-serif; margin: 0; background: #f4f4f4; }
    header { background: #00bcd4; color: white; padding: 1rem; text-align: center; }
    .container { padding: 1rem; }
    .room-card { padding: 1rem; margin-bottom: 1rem; border-radius: 10px; background: #fff; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    .red { border-left: 8px solid #e53935; }
    .yellow { border-left: 8px solid #fbc02d; }
    .green { border-left: 8px solid #43a047; }
    .button { background: #00bcd4; color: white; border: none; padding: 0.5rem 1rem; margin-top: 0.5rem; cursor: pointer; border-radius: 6px; }
    .hidden { display: none; }
    input, select { margin: 0.5rem 0; padding: 0.5rem; width: 100%; }
    table { width: 100%; margin-top: 1rem; border-collapse: collapse; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: left; }
  </style>
</head>
<body>

<header>
  <div id="titleText">SmartRent Manager</div>
</header>

<!-- LOGIN SCREEN -->
<div class="container" id="loginScreen">
  <h2>Login</h2>
  <input id="username" placeholder="Username" />
  <input id="password" type="password" placeholder="Password" />
  <button class="button" onclick="login()">Login</button>
</div>

<!-- MAIN APP SCREENS -->
<div class="container hidden" id="roomListView">
  <select onchange="setLang(this.value)">
    <option value="en">EN</option>
    <option value="th">TH</option>
    <option value="zh">中文</option>
  </select>
  <h2 id="listTitle">All Rooms</h2>
  <div id="roomList"></div>
</div>

<div class="container hidden" id="roomDetailView">
  <h2 id="detailTitle">Room Detail</h2>
  <div id="roomDetailInfo"></div>
  <h3 id="txTitle">Income/Expense</h3>
  <table><thead><tr><th>Date</th><th>Type</th><th>Description</th><th>Amount</th></tr></thead><tbody id="transactionList"></tbody></table>
  <h3 id="addTxTitle">Add Transaction</h3>
  <input id="txDate" type="date" />
  <select id="txType"><option value="income">Income</option><option value="expense">Expense</option></select>
  <input id="txDesc" placeholder="Description" />
  <input id="txAmount" type="number" placeholder="Amount" />
  <button class="button" onclick="addTransaction()">Add</button><br><br>
  <button class="button" onclick="backToList()">Back</button>
</div>

<div class="container hidden" id="summaryView">
  <h2 id="summaryTitle">Summary Chart</h2>
  <canvas id="summaryChart" width="400" height="200"></canvas>
</div>

<script>
const user = "admin", pass = "0000";
const langText = {
  en: { title: "SmartRent Manager", list: "All Rooms", detail: "Room Detail", tx: "Income/Expense", addTx: "Add Transaction", summary: "Summary Chart", back: "Back" },
  th: { title: "สมาร์ทเรนท์ แมเนเจอร์", list: "รายการห้องทั้งหมด", detail: "รายละเอียดห้อง", tx: "รายรับ/รายจ่าย", addTx: "เพิ่มรายการ", summary: "สรุปรายงาน", back: "ย้อนกลับ" },
  zh: { title: "智能租赁管理", list: "所有房间", detail: "房间详情", tx: "收入/支出", addTx: "新增项目", summary: "总结图表", back: "返回" }
};
let lang = "en";
let currentRoom = null;

function login() {
  const u = document.getElementById("username").value;
  const p = document.getElementById("password").value;
  if (u === user && p === pass) {
    document.getElementById("loginScreen").classList.add("hidden");
    document.getElementById("roomListView").classList.remove("hidden");
    renderRoomList(); drawChart(); setLang(lang);
  } else {
    alert("Login failed");
  }
}

function setLang(l) {
  lang = l;
  document.getElementById("titleText").innerText = langText[l].title;
  document.getElementById("listTitle").innerText = langText[l].list;
  document.getElementById("detailTitle").innerText = langText[l].detail;
  document.getElementById("txTitle").innerText = langText[l].tx;
  document.getElementById("addTxTitle").innerText = langText[l].addTx;
  document.querySelector("#roomDetailView button:last-of-type").innerText = langText[l].back;
  document.getElementById("summaryTitle").innerText = langText[l].summary;
}

const rooms = [
  { id: "101", project: "SkyView", number: "101", rent: 8000, contractEnd: "2024-09-01", dueDay: 1, transactions: [ { date: "2024-01-01", type: "income", desc: "Rent Jan", amount: 8000 } ] },
  { id: "102", project: "SkyView", number: "102", rent: 8500, contractEnd: "2025-12-01", dueDay: 15, transactions: [ { date: "2024-01-15", type: "income", desc: "Rent Jan", amount: 8500 } ] },
  { id: "103", project: "SkyView", number: "103", rent: 8200, contractEnd: "2024-07-01", dueDay: 1, transactions: [ { date: "2024-01-01", type: "expense", desc: "Fix pipe", amount: 1200 } ] }
];

function getStatus(room) {
  const today = new Date();
  const endDate = new Date(room.contractEnd);
  const msPerMonth = 30 * 24 * 60 * 60 * 1000;
  const monthsLeft = (endDate - today) / msPerMonth;
  if (monthsLeft < 3) return 'red';
  const due = new Date(today.getFullYear(), today.getMonth(), room.dueDay);
  const latest = room.transactions.filter(t => t.type === 'income').map(t => new Date(t.date)).sort((a,b)=>b-a)[0];
  if (!latest || latest < due) return 'yellow';
  return 'green';
}

function renderRoomList() {
  const list = document.getElementById("roomList");
  list.innerHTML = "";
  rooms.sort((a,b)=> {
    const colorOrder = { red:0, yellow:1, green:2 };
    const sa = getStatus(a), sb = getStatus(b);
    if (colorOrder[sa] !== colorOrder[sb]) return colorOrder[sa]-colorOrder[sb];
    return a.number.localeCompare(b.number);
  }).forEach(room => {
    const card = document.createElement("div");
    card.className = "room-card " + getStatus(room);
    card.innerHTML = `<strong>${room.project}</strong><br>Room: ${room.number}<br>Rent: ${room.rent} THB<br>
                      <button class='button' onclick="viewRoom('${room.id}')">View</button>`;
    list.appendChild(card);
  });
}

function viewRoom(id) {
  currentRoom = rooms.find(r => r.id === id);
  document.getElementById("roomListView").classList.add("hidden");
  document.getElementById("roomDetailView").classList.remove("hidden");
  document.getElementById("roomDetailInfo").innerHTML = `
    <strong>Room:</strong> ${currentRoom.number}<br>
    <strong>Contract End:</strong> ${currentRoom.contractEnd}<br>
    <strong>Status:</strong> ${getStatus(currentRoom).toUpperCase()}
  `;
  renderTransactions();
}

function renderTransactions() {
  const body = document.getElementById("transactionList");
  body.innerHTML = "";
  currentRoom.transactions.forEach(t => {
    const row = document.createElement("tr");
    row.innerHTML = `<td>${t.date}</td><td>${t.type}</td><td>${t.desc}</td><td>${t.amount}</td>`;
    body.appendChild(row);
  });
}

function addTransaction() {
  const d = document.getElementById("txDate").value;
  const t = document.getElementById("txType").value;
  const desc = document.getElementById("txDesc").value;
  const amt = parseFloat(document.getElementById("txAmount").value);
  if (d && t && desc && !isNaN(amt)) {
    currentRoom.transactions.push({ date: d, type: t, desc, amount: amt });
    renderTransactions();
  }
}

function backToList() {
  document.getElementById("roomDetailView").classList.add("hidden");
  document.getElementById("roomListView").classList.remove("hidden");
  renderRoomList(); drawChart(); setLang(lang);
}

function drawChart() {
  const ctx = document.getElementById('summaryChart').getContext('2d');
  const labels = rooms.map(r => r.number);
  const income = rooms.map(r => r.transactions.filter(t=>t.type==='income').reduce((s,t)=>s+t.amount,0));
  const expense = rooms.map(r => r.transactions.filter(t=>t.type==='expense').reduce((s,t)=>s+t.amount,0));

  new Chart(ctx, {
    type: 'bar',
    data: {
      labels,
      datasets: [
        { label: 'Income', data: income, backgroundColor: 'green' },
        { label: 'Expense', data: expense, backgroundColor: 'red' }
      ]
    }
  });
}
</script>

</body>
</html>
